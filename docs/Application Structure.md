# Generic Information: Application Structure
## Orion-Native Applications

Unlike most other [Linux-based operating systems,](https://en.wikipedia.org/wiki/Linux_distribution) The Orion Operating System has a custom Native
Application Structure. This is to make the operating system easier to use for beginners, more stable since Applications store all content internally,
and also provides several other utilities to make development for the operating system easier.

## Structure Overview
Orion-Native Applications (OApps) reside in a custom directory structure. All the contents of a given Application, both user-generated and static, are stored within directories inside of the Application itself. The top-level directory ends with a `.oapp` extension.

If the Application Structure is valid, the Orion File Manager will hide the extension and show the directory as if it were a single, executable file, with a custom icon.

Within the Application's directory resides a list of internal directories used by the Application and OrionAPI.
Not all of the internal directories are required to be populated, however they are required to exist.

The following is the directory structure of an average Orion-Native Application:
```
MyOApp.oapp/         - <The Application>
    .SYS/            - <Internal, Orion/OrionAPI only>
        run.sh*      - <Runs this Application and feeds data from conf.cfg to OrionAPI>
        conf.cfg     - <Metadata regarding this Application>
        INSTALL.sh   - <Ran by Orion on install>
        UNINSTALL.sh - <Ran by Orion on uninstall>
    libs/            - <Non-Native Libraries>
    static/          - <Application-wide Data Storage>
    data/            - <User-specific Data Storage>
        <username>/  - <A given user's data directory>
        ...          - <A directory for as many users are there are on the system>
    src/             - <Application Source>
    icon.png         - <AppIcon. Can also be under "static/">
    MyOApp.oapp*     - <Binary> 
```
**[Files marked with a `*` are required by Orion. All directories are required]**

### .SYS/
This directory is hidden and reserved for Orion and OrionAPI. Internal information regarding the Application is initialised in this directory.
Developers or users are not meant to place files or folders within this directory.

**[OrionAPI refers to this directory internally as `OAPP_INTPATH`]** (ONLY if `ORION_INTERNAL` is [defined](https://github.com/RosettaHS/OrionAPI/blob/main/docs/API%20Configuration.md))

### libs/
Orion uses the Orion-Native Application Structure to make all Applications entirely self-contained to minimise pollution of the system.
Instead of making Applications install all of their [libraries and dependencies](https://en.wikipedia.org/wiki/Library_(computing)#Shared_libraries) to the [system's root directories](https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard) (as seen with most Linux programs),
Orion allows Applications to store their libraries' [header](https://en.wikipedia.org/wiki/Include_directive) and [object](https://en.wikipedia.org/wiki/Object_file) files
within an internal directory inside of the Application's Structure.

This can be organised entirely to the developer's own wishes, however the library's shared object files must reside within this directory, or within a subdirectory.
Headers, however, may be placed in `src/` as well, and are not required to be within `libs/`.

**[OrionAPI refers to this directory as `OAPP_LIBPATH`]**

### static/
This is a dedicated data directory for the Application to store and read static content (such as icons, videos, text, etc)
that the Application (and only the Application) might require for its usual operation. The developer may organise this directory to their own wishes,
however the directory is **NOT** for storing user-generated, or user-specific content (such as logins, settings, content generated by the user, etc). For this, see `data/<username>`

It's recommended to have all of this directory's content populated prior to the operation of the Application.
It is also recommended to not delete or create new files within this directory during the lifespan of the Application. The content within should remain constant from installation up until (at least) new releases of the Application.
This directory is meant to be static and only store content required for properly displaying and running the Application.

Any content stored in this directory will be read the same regardless of the user running the Application,
meaning having variable content within this directory is a bad practise since the state of the file(s) can change across sessions, rendering it no longer "static".

A good example of a correct use of this directory would be a Graphical Application that stores the icons for the buttons, and localised text within this directory,
and those files are created and stored within the directory prior to release (meaning the Application does not generate these files during operation).

Another good example would be the Manual App in Orion, since it stores all of the documentation markdown files (such as this very file) internally within `static/`

**[OrionAPI refers to this directory as `OAPP_STATICPATH`]**

### data/\<username\>
Alongside the Orion-Native Application Structure providing dedicated storage locations for the Application's static content and dependencies,
it also provides locations to store user-specific content.

When a (new) user loads the Application for the first time, OrionAPI will automatically create a special subdirectory within `data/` with their username as the subdirectory's name.
If OrionAPI is initialised correctly, it will then initialise `OAPP_DATAPATH` to point to this subdirectory.

This (sub)directory is specific to the given user, and multiple user accounts of the system can share the same OApp yet have entirely content stored due to this directory structure.
A user (or Application instance) can only read data from within their own subdirectory, and cannot access data from another user's subdirectory.

All content stored within this (sub)directory **MUST** be evaluated and populated at some point during runtime, manually creating or storing content within any of these subdirectories prior to the Application's initialisation (as you would with `static/`) is **forbidden.**

Applications must be designed to work correctly with this structure, as any and all content stored within these subdirectories are subject to change throughout the lifespan of the Application, and will change when a different user loads the Application.

Although, Applications do not need to manually access a given user's subdirectory by checking the user and attempting to search for the user's given subdirectory,
instead it can use the `OAPP_DATAPATH` [helper](https://github.com/RosettaHS/OrionAPI/blob/main/docs/API%20Configuration.md#orion_nohelpers) to immediately access the corrisponding data subdirectory
without having to perform any manual searches for the user's subdirectory.

Unlike with `static/`, assuming a given file or folder will exist within any of these subdirectories is dangerous, as there is no guarantee a given file will even exist at all
since multiple users can run a given Application, and thus entirely different contents will be loaded as well.

This (sub)directory is best suited for storing user-generated content (such as logins, and settings), although what content may be stored is entirely up to the type of the Application.
For example, the Notes App in Orion stores each users' notes (user-generated content) within these subdirectories instead of storing them externally to the `Documents` folder in the user's [home directory.](https://en.wikipedia.org/wiki/Home_directory)

Using this as a substitute for storing user-generated content externally (such as to `Images` if it's an image editing Application) is a valid, and often recommended use for this directory structure,
however providing an option to export content externally is highly recommended.

**[OrionAPI refers to this directory as `OAPP_DATAPATH`]**

### src/
**[This directory is entirely optional]**

This directory is designed to store the [source code](https://en.wikipedia.org/wiki/Source_code) of the Application for distribution.
The main purpose of this directory is to allow for Applications to be easily updated with minimal network use, since only the modified source files would be downloaded,
and the Application would be compiled on the user's computer.

However this means the Application will be larger since not only will it store the Application's binary, but also the entirety of the source code.
Alongside this limitation, it is also only for [open-source](https://en.wikipedia.org/wiki/Open-source_software) software,
as [proprietary software](https://en.wikipedia.org/wiki/Proprietary_software) developers do not publish their source code alongside the Application.

**[OrionAPI does not refer to this directory]**

## OrionAPI Integration
Alongside the general tools for modifying and accessing files and directories, OrionAPI also provides tools for easily interfacing with the Application's structure.
Internally, OrionAPI provides a struct that contains information regarding an Application and its structure:
```cpp
struct OAppInfo{
	const char* name;
	const char* identifier;
	const char* username;
	float scale;
	pid_t pid;
	struct{
		char* staticPath;
		char* libPath;
		char* dataPath;
		char* internalPath;
	}Storage;
	struct{
		char* toBinary;
		char* toBinaryFolder;
		char* toHome;
		char* toCWD;
	}Path;
	struct{
		bool isNativeOApp;
		bool isVerbose;
		bool isRunning;
	}Flags;
};
```
This struct has a [global instance](https://en.wikipedia.org/wiki/Global_variable) (`OApp`) that refers to the running Application.
When OrionAPI is initialised using `OAppStart()`, it will automatically scan the Application and detect if it is an Orion-Native Application.
If it comes back conclusive (a valid structure), it will initialise the global instance (`OApp`) and all of its [helpers](https://github.com/RosettaHS/OrionAPI/blob/main/docs/API%20Configuration.md#orion_nohelpers) to point to the given internal directories of the Application.

Through this instance, a developer can access the directories inside of the Application to utilise for data storage.
There are many [helpers](https://github.com/RosettaHS/OrionAPI/blob/main/docs/API%20Configuration.md#orion_nohelpers) provided by OrionAPI,
but the following helpers point specifically to the Application's internal directories.
```
OAPP_STORAGE    - <Points to the Storage struct within OApp>
OAPP_STATICPATH - <Points to the Application's "static/" directory>
OAPP_LIBPATH    - <Points to the Application's "libs/" directory>
OAPP_DATAPATH   - <Points to the current user's "data/" subdirectory>
```
Another thing to note is that if the Application's binary merely sits in a folder with the extension `.oapp`,
OrionAPI will automatically populate that folder with the required directories for the Orion-Native Application Structure,
and the Orion Operating System will immediately recognise the folder as a valid OApp, and will display it accordingly.
### Utilising Helpers
**[All of the code examples in this section assume that the Application's binary is within a folder with the extension `.oapp`.
If it is not in this structure, create a folder with any name (such as `MyOApp`) and give it the `.oapp` extension (making this example `MyOApp.oapp`)
and it will be automatically populated]**

When these helpers are initialised through `OAppStart()`, they can be used as directory inputs when using OFile and ODirectory.
The following code creates an Application that will create a file with some text inside of the user's data subdirectory, and then reads it upon next launch:
```cpp
#include <OrionAPI>

int main(void){
	OAppStart("MyOApp"); /* To initialise the Application and its directories. */

	OFile file;
	if(OAPP_DATAPATH){ /* If the Application has been initialised correctly. */
		if( OFileExists(OAPP_DATAPATH,"myFile.txt") ){
			/* If the file has been created, read it! */
			file.open(OAPP_DATAPATH,"myFile.txt");
			file.log();
			file.close(false);
		}else{
			/* If the file has not been created, create it first for it to be read next launch. */
			file.open(OAPP_DATAPATH,"myFile.txt");
			file.setLine(0,"Hello World!");
			file.close(true);
			OLog("File has been created!\n");
		}
	}

	OAppEnd(); /* To free the global instance. */
}
```
Upon running this Application for the first time, it will only display `File has been created!` to the terminal,
however the second time it is ran, it will read out the contents of `myFile.txt` to the terminal, which in this example is `Hello World!`.

This is an example of utilising the Application's data directories for storing and accessing information.
Note that since this is using `OAPP_DATAPATH`, it will create a separate `myFile.txt` for each user that runs the Application.

Also note that the same Application can be written without helpers, and instead interfacing with the global instance directly:
```cpp
#include <OrionAPI>

int main(void){
	OAppStart("MyOApp"); /* To initialise the Application and its directories. */

	OFile file;
	if(OApp.Storage.dataPath){ /* If the Application has been initialised correctly. */
		if( OFileExists(OApp.Storage.dataPath,"myFile.txt") ){
			/* If the file has been created, read it! */
			file.open(OAPP_DATAPATH,"myFile.txt");
			file.log();
			file.close(false);
		}else{
			/* If the file has not been created, create it first for it to be read next launch. */
			file.open(OApp.Storage.dataPath,"myFile.txt");
			file.setLine(0,"Hello World!");
			file.close(true);
			OLog("File has been created!\n");
		}
	}

	OAppEnd(); /* To free the global instance. */
}
```
This is a valid approach, and functions identically to using `OAPP_DATAPATH`, `OAPP.Storage.dataPath`, or `OAPP_STORAGE.dataPath` instead.